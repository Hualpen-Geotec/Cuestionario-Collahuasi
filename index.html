<script>
  document.addEventListener("DOMContentLoaded", () => {
    const RUT_URL = "https://script.google.com/macros/s/AKfycbzvjsK77j6Fm3j3fcNsSWQwWf9F8ZLwuZzJ4IrkumTzSKLSJskOxfUc_OzlfgNii2FG5g/exec";

    const rutInput = document.getElementById("rut");
    const nombreInput = document.getElementById("nombreInput");
    const correoInput = document.getElementById("correoInput");
    const mensaje = document.getElementById("mensaje");
    const datosUsuario = document.getElementById("datosUsuario");

    rutInput.addEventListener("input", function () {
      this.value = this.value.replace(/\D/g, "");
    });

    document.getElementById("buscarRutBtn").addEventListener("click", async function () {
      const rutIngresado = rutInput.value.trim();
      mensaje.textContent = "";

      if (rutIngresado.length < 7) {
        mensaje.textContent = "Por favor, ingresa un RUT válido.";
        return;
      }

      try {
        const res = await fetch(`${RUT_URL}?rut=${rutIngresado}`);
        const data = await res.json();

        if (data.autorizado) {
          nombreInput.value = data.nombre || "";
          correoInput.value = data.correo || "";
          datosUsuario.style.display = "block";
        } else {
          mensaje.textContent = "Este RUT no está autorizado para realizar el cuestionario.";
        }
      } catch (err) {
        mensaje.textContent = "Error al validar el RUT.";
      }
    });

    document.getElementById("continuarBtn").addEventListener("click", () => {
      const rut = rutInput.value.trim();
      const nombre = nombreInput.value.trim();
      const correo = correoInput.value.trim();

      if (!rut || !nombre || !correo) {
        alert("Por favor, completa todos los datos.");
        return;
      }

      localStorage.setItem("rut", rut);
      localStorage.setItem("nombre", nombre);
      localStorage.setItem("correo", correo);

      window.location.href = "forms.html";
    });
  });
</script>

