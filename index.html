<script>
  const RUT_URL = "https://script.google.com/macros/s/AKfycbzvjsK77j6Fm3j3fcNsSWQwWf9F8ZLwuZzJ4IrkumTzSKLSJskOxfUc_OzlfgNii2FG5g/exec";

  document.getElementById("rut").addEventListener("input", function () {
    this.value = this.value.replace(/\D/g, "");
  });

  document.getElementById("rut").addEventListener("blur", async function () {
    const rutIngresado = this.value.trim();
    const mensaje = document.getElementById("mensaje");
    mensaje.textContent = "";

    if (rutIngresado.length < 7) {
      mensaje.textContent = "Por favor, ingresa un RUT válido.";
      return;
    }

    try {
      const res = await fetch(`${RUT_URL}?rut=${rutIngresado}`);
      const data = await res.json();

      if (data.autorizado) {
        document.getElementById("nombreInput").value = data.nombre || "";
        document.getElementById("correoInput").value = data.correo || "";
        document.getElementById("datosUsuario").style.display = "block";
      } else {
        mensaje.textContent = "Este RUT no está autorizado para realizar el cuestionario.";
      }
    } catch (err) {
      mensaje.textContent = "Error al validar el RUT.";
    }
  });

  document.getElementById("continuarBtn").addEventListener("click", () => {
    const rut = document.getElementById("rut").value.trim();
    const nombre = document.getElementById("nombreInput").value.trim();
    const correo = document.getElementById("correoInput").value.trim();

    if (!rut || !nombre || !correo) {
      alert("Por favor, completa todos los datos.");
      return;
    }

    localStorage.setItem("rut", rut);
    localStorage.setItem("nombre", nombre);
    localStorage.setItem("correo", correo);

    window.location.href = "forms.html";
  });
</script>
